(this["webpackJsonpreact-pangul"]=this["webpackJsonpreact-pangul"]||[]).push([[0],Array(32).concat([function(e,t,r){e.exports=r(78)},,,,,,function(e,t,r){},,function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},,,,,function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);var n=r(0),a=r(17),s=r(3),o=r(6),c=r(9),u=r(1),i=r.n(u),p=r(2),l=r(80);class h{constructor(e){this.parent=void 0,this.props=void 0,this.error=void 0,this.updating=void 0,this.updateDepth=0,this.observer=new l.a,this.error=null,this.updating=!1,this.parent=null,this.props={},this._unsafeAssignState(e)}subscribe(e){const t=this.observer.subscribe(e);return()=>{t.unsubscribe()}}update(e){var t=this;return Object(p.a)(i.a.mark((function r(){var n;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t._startUpdate(),r.prev=1,r.next=4,e();case 4:(n=r.sent)&&(t.props=Object(s.a)({},t.props,{},n)),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),t.error=r.t0;case 11:t._completedUpdate();case 12:case"end":return r.stop()}}),r,null,[[1,8]])})))()}_startUpdate(){this.updateDepth+=1,this.updating=!0,this.error=null,1===this.updateDepth&&this.observer.next(this),this.parent&&this.parent._startUpdate()}_completedUpdate(){this.updateDepth-=1,0===this.updateDepth&&(this.updating=!1,this.parent&&this.parent._completedUpdate(),this.observer.next(this))}_unsafeAssignState(e){if(e){this.props=e;try{for(var t=0,r=Object.entries(e);t<r.length;t++){const e=r[t];e[1]instanceof h&&(e[1].parent=this)}}catch(n){}}}}class d extends h{constructor(e){super(e||{}),e||this._unsafeAssignState(this.blank()),this.rebind()}get state(){return this.props}update(e){var t=()=>super.update,r=this;return Object(p.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t().call(r,e);case 2:r.rebind();case 3:case"end":return n.stop()}}),n)})))()}}class m extends d{reset(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.blank());case 1:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}blank(){return{loggedIn:!1,permissions:[],username:"anonymous user"}}rebind(){}}r(38);class f extends n.Component{render(){return n.createElement("div",{className:"component--LayoutTheme"},this.props.children)}}r(39);class v{get(){const e=this.provide();if(!e)throw new Error("Provider not configured");return e}}const w=new class extends v{constructor(e){super(),this.factory=e}configure(e){this.factory=e}provide(){return null==this.factory?null:this.factory()}}(null);class x extends Error{constructor(e,t){super(e),this.innerErrors={},this.innerErrors=t}}class b{static serializeRequestBody(e){try{return JSON.stringify(e)}catch(t){const r=w.get();throw r.info("Unable to serialize object",e),r.error(t),new Error("Request failed: Unable to serialize object for POST")}}constructor(e){this.rootUrl=e}get(e){var t=this;return Object(p.a)(i.a.mark((function r(){var n;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fetch("".concat(t.rootUrl).concat(e),{method:"GET"});case 2:if((n=r.sent).ok){r.next=5;break}throw new Error(n.statusText);case 5:return r.abrupt("return",n.json());case 6:case"end":return r.stop()}}),r)})))()}post(e,t){var r=this;return Object(p.a)(i.a.mark((function n(){var a,s,o,c;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new Headers({Accept:"*/*","Content-Type":"application/json","X-Requested-With":"PANGUL"}),n.prev=1,s=b.serializeRequestBody(t),n.next=5,fetch("".concat(r.rootUrl).concat(e),{body:s,cache:"no-cache",credentials:"include",headers:a,method:"POST",mode:"cors",redirect:"follow"});case 5:if((o=n.sent).ok){n.next=17;break}return n.prev=7,n.next=10,o.json();case 10:return c=n.sent,n.abrupt("return",{error:new x(c.result,c.errors),success:!1});case 14:return n.prev=14,n.t0=n.catch(7),n.abrupt("return",{error:new Error("Request failed: ".concat(o.status,": ").concat(o.statusText)),success:!1});case 17:return n.next=19,o.json();case 19:return n.abrupt("return",n.sent);case 22:return n.prev=22,n.t1=n.catch(1),n.abrupt("return",{error:n.t1,success:!1});case 25:case"end":return n.stop()}}),n,null,[[1,22],[7,14]])})))()}}class g{error(e){e&&window.console.error(e)}info(e,...t){window.console.log(e,...t)}}class E extends v{constructor(e){super(),this.instance=e}configure(e){this.instance=e}provide(){return this.instance}}const k=new E(null),j=new E(null);class O{get fetch(){return k.get()}get logger(){return w.get()}post(e,t){var r=this;return Object(p.a)(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.fetch.post(e,t);case 2:if(!(a=n.sent).success){n.next=5;break}return n.abrupt("return",a.data);case 5:if(r.logger.error(a),null==a.error){n.next=8;break}throw a.error;case 8:throw new Error("Internal server error");case 9:case"end":return n.stop()}}),n)})))()}}class q extends O{login(e,t){var r=this;return Object(p.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.post("/api/auth/login",{username:e,password:t});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))()}logout(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.post("/api/auth/logout",null);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}claims(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.post("/api/auth/claims",null));case 1:case"end":return t.stop()}}),t)})))()}}class C{constructor(){this.authController=void 0,this.authController=new q}login(e,t,r){var n=this;return Object(p.a)(i.a.mark((function a(){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.update(Object(p.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.authController.login(t,r);case 2:return e.next=4,n.authController.claims();case 4:return a=e.sent,e.abrupt("return",{loggedIn:!0,permissions:a.claims,username:a.token});case 6:case"end":return e.stop()}}),e)}))));case 2:case"end":return a.stop()}}),a)})))()}logout(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.update(Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.authController.logout();case 2:return r.next=4,e.reset();case 4:return r.abrupt("return",null);case 5:case"end":return r.stop()}}),r)}))));case 2:case"end":return r.stop()}}),r)})))()}hasPermissions(e,t){if(0===t.length)return!1;if(null==e)return!1;return 0===t.filter(t=>!e.state.permissions.find(e=>e===t)).length}refresh(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.update(Object(p.a)(i.a.mark((function r(){var n;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.authController.claims();case 3:return n=r.sent,r.abrupt("return",{loggedIn:!0,permissions:n.claims,username:n.token});case 7:return r.prev=7,r.t0=r.catch(0),r.next=11,e.reset();case 11:return r.abrupt("return",e.state);case 12:case"end":return r.stop()}}),r,null,[[0,7]])}))));case 2:case"end":return r.stop()}}),r)})))()}}r(40);class S extends n.Component{render(){return this.props.loading?n.createElement("div",{className:"component--PageLoader"},n.createElement("div",null,"loading")):n.createElement(n.Fragment,null)}}r(41);class I extends n.PureComponent{render(){return n.createElement("div",{className:"component--LayoutContentContainer"},this.props.children)}}r(42);class N extends n.Component{constructor(e){super(e),this.innerRef=void 0,this.innerRef=n.createRef()}render(){return this.props.error?(this.scrollAsync(),n.createElement("div",{className:"component--ErrorNotice",ref:this.innerRef},n.createElement("em",null,this.props.error.message),this.renderInnerErrors())):n.createElement(n.Fragment,null)}renderInnerErrors(){if(null==this.props.error||!this.props.error.innerErrors)return"";const e=[];for(var t=0,r=Object.entries(this.props.error.innerErrors);t<r.length;t++){const a=r[t];e.push(n.createElement("li",{key:a[0]},a[0],": ",a[1]))}return n.createElement("ul",null,e)}scrollAsync(){setTimeout(()=>{if(null!=this.innerRef.current){a.findDOMNode(this.innerRef.current).scrollIntoView({block:"end",behavior:"smooth"})}},1)}}r(43);class y extends n.Component{render(){return n.createElement("div",{className:"component--LayoutFormContainer"},n.createElement(N,{error:this.props.error}),this.props.children)}}r(44);class T extends n.PureComponent{render(){const e=this.props.expand?"static":"absolute";return n.createElement("div",{className:"component--LayoutRightBox",style:{position:e}},this.props.children)}}r(45);class D extends n.Component{constructor(e){super(e),this.onSubmitLogin=e=>{e.preventDefault(),(new C).login(this.props.user,this.state.username,this.state.password)},this.onUsernameChange=e=>{this.setState({username:e.currentTarget.value})},this.onPasswordChange=e=>{this.setState({password:e.currentTarget.value})},this.state={password:"...",username:"username"}}render(){return n.createElement("div",{className:"component--GenericLoginPage"},n.createElement(S,{loading:this.props.user.updating}),n.createElement(I,null,n.createElement("h3",{className:"notice"},"Login required")),n.createElement(y,{error:this.props.user.error},n.createElement("form",{onSubmit:this.onSubmitLogin},n.createElement("fieldset",null,n.createElement("input",{type:"text",value:this.state.username,onChange:this.onUsernameChange})),n.createElement("fieldset",null,n.createElement("input",{type:"password",value:this.state.password,onChange:this.onPasswordChange})),n.createElement(T,{expand:!0},n.createElement("button",null,"Login")))))}}class P extends n.Component{static getDerivedStateFromProps(e,t){return e.user!==t.user?{user:e.user,refreshed:!1}:null}constructor(e){super(e),this.unsubscribe=null,this.state={refreshed:!1,user:null}}componentWillUnmount(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}componentDidMount(){this.resubscribe()}render(){const e=this.props.user.state.loggedIn?this.props.renderLoggedIn():this.props.renderLoggedOut();return n.createElement(n.Fragment,null,e)}componentDidUpdate(){this.state.refreshed||this.resubscribe()}resubscribe(){var e=this;this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.state.user&&Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.state.user){t.next=5;break}return e.unsubscribe=e.state.user.subscribe(()=>{e.forceUpdate()}),r=new C,t.next=5,r.refresh(e.props.user);case 5:case"end":return t.stop()}}),t)})))().then(()=>{this.setState({refreshed:!0})})}}var F=r(27),U=r(28);r(46);class Q extends n.Component{static safe(e){return U(e,{allowProtocolRelative:!0,allowedAttributes:{a:["href","name","target"],img:["src"]},allowedIframeHostnames:[],allowedTags:["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre","iframe","img"],allowedSchemes:["http","https"],allowedSchemesAppliedToAttributes:["href","src","cite"],allowedSchemesByTag:{},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"]})}constructor(e){super(e)}render(){const e=Q.safe(this.props.value);return n.createElement("div",{className:"component--SafeHtml",dangerouslySetInnerHTML:{__html:e}})}}class V extends n.PureComponent{constructor(e){super(e),this.converter=void 0,this.converter=new F.Converter}render(){try{const e=this.converter.makeHtml(this.props.markdown);return n.createElement(n.Fragment,null,n.createElement(Q,{value:e}))}catch(e){return n.createElement(N,{error:e})}}}r(47);class A extends n.Component{static getDerivedStateFromProps(e,t){return e.value!==t.lastPropValue?{value:e.value,lastPropValue:e.value}:null}constructor(e){super(e),this.events={},this.state={lastPropValue:"",value:""},this.events={onChange:e=>this.onChange(e)}}render(){return n.createElement("div",{className:"component--MarkdownEditor"},n.createElement("textarea",{value:this.state.value,onChange:this.events.onChange}),n.createElement("div",{className:"rendered"},n.createElement(V,{markdown:this.state.value})))}onChange(e){const t=e.currentTarget.value;this.setState({value:t},()=>{this.props.onChange(t)})}}class L extends n.Component{constructor(e){super(e),this.events={},this.unsubscribe=null,this.state={lastUpdate:new Date},this.events={onBodyChanged:e=>this.onBodyChanged(e),onSave:e=>this.onSave(e)}}componentDidMount(){this.unsubscribe=this.props.answer.subscribe(()=>{this.setState({lastUpdate:new Date})})}componentWillUnmount(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}render(){return n.createElement("div",{className:"component--Answer"},n.createElement("form",{action:"",onSubmit:this.events.onSave},n.createElement("fieldset",null,n.createElement(A,{value:this.props.answer.state.body,onChange:this.events.onBodyChanged})),n.createElement("fieldset",{className:"buttons"},n.createElement("button",{className:"submit"},this.props.saveText))))}onSave(e){e.preventDefault(),this.props.submit()}onBodyChanged(e){this.props.answer.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{body:e});case 1:case"end":return t.stop()}}),t)}))))}}r(48);class z extends n.Component{constructor(e){super(e),this.innerRef=void 0,this.innerRef=n.createRef()}render(){return this.props.value?(this.scrollAsync(),n.createElement("div",{className:"component--InfoNotice",ref:this.innerRef},this.props.value)):n.createElement(n.Fragment,null)}scrollAsync(){setTimeout(()=>{if(null!=this.innerRef.current){a.findDOMNode(this.innerRef.current).scrollIntoView({block:"end",behavior:"smooth"})}},1)}}class M extends O{delete(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/topics/delete",{RowVersion:e.rowVersion,TopicId:e.topicId});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}get(e,t){var r=this;return Object(p.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=4;break}return n.next=3,r.post("/api/topics/get",{TopicId:t});case 3:return n.abrupt("return",n.sent);case 4:return n.next=6,r.post("/api/topics/get",{TopicName:e});case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n)})))()}update(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/topics/update",e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}search(e,t,r){var n=this;return Object(p.a)(i.a.mark((function a(){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.post("/api/topics/search",{limit:r,offset:t,query:e});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()}}class R extends d{static fromQuery(e,t){return Object(p.a)(i.a.mark((function r(){var n;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=new R(Object(s.a)({},e,{instances:[],moreResults:!1,page:-1})),null===t||void 0===t){r.next=4;break}return r.next=4,n.fetch(t);case 4:return r.abrupt("return",n);case 5:case"end":return r.stop()}}),r)})))()}fetch(e){var t=this;return this.update(Object(p.a)(i.a.mark((function r(){var n,a,s,o;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e<=0?0:e*t.state.pageSize,r.next=3,t.state.fetchIds(t.state.query,n,t.state.pageSize);case 3:return a=r.sent,s=a.identityList.map(e=>t.state.fetchInstance(e)),r.next=7,Promise.all(s);case 7:return o=r.sent,r.abrupt("return",{instances:o,moreResults:a.moreResults,page:e});case 9:case"end":return r.stop()}}),r)}))))}next(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.state.moreResults){t.next=2;break}throw new Error("No more results in QuerySet");case 2:return t.abrupt("return",null);case 3:case"end":return t.stop()}}),t)}))));case 2:if(e.error){t.next=5;break}return t.next=5,e.fetch(e.state.page+1);case 5:case"end":return t.stop()}}),t)})))()}prev(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.state.page<=0)){t.next=2;break}throw new Error("Already on first page of QuerySet");case 2:return t.abrupt("return",null);case 3:case"end":return t.stop()}}),t)}))));case 2:if(e.error){t.next=5;break}return t.next=5,e.fetch(e.state.page-1);case 5:case"end":return t.stop()}}),t)})))()}blank(){return{fetchIds:()=>Promise.reject(new Error("Not implemented")),fetchInstance:()=>Promise.reject(new Error("Not implemented")),instances:[],moreResults:!1,page:0,pageSize:10,query:""}}rebind(){this.state.instances.map(e=>{e.parent=this})}}class B extends d{static get(e){return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new B).state.name=e,t.next=4,r.refresh();case 4:return t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()}static search(e,t=10,r=0){return R.fromQuery({fetchIds:B.searchForIds,fetchInstance:B.getById,pageSize:t,query:e},r)}static getById(e){return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new B).state.topicId=e,t.next=4,r.refresh();case 4:return t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()}static searchForIds(e,t,r){return Object(p.a)(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new M,n.next=3,a.search(e,t,r);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}delete(){var e=this;return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new M,t.next=3,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.delete(e.state);case 2:return t.abrupt("return",e.blank());case 3:case"end":return t.stop()}}),t)}))));case 3:case"end":return t.stop()}}),t)})))()}refresh(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchData(e.state.name,e.state.topicId);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}reset(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.blank());case 1:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}save(){var e=this;return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new M,t.next=3,e.update(Object(p.a)(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Object(s.a)({},e.state),e.state.topicId){t.next=3;break}throw new Error("Topics can only be auto-generated, use Topic.get");case 3:return t.next=5,r.update(n);case 5:return t.next=7,e.fetchData(e.state.name,null);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)}))));case 3:case"end":return t.stop()}}),t)})))()}blank(){return{description:"",icon:"",name:"",rowVersion:"",topicId:""}}fetchData(e,t){return Object(p.a)(i.a.mark((function r(){var n,a;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new M,r.next=3,n.get(e,t);case 3:return a=r.sent,r.abrupt("return",a);case 5:case"end":return r.stop()}}),r)})))()}rebind(){}}class W{constructor(){this.root=void 0,this.root=j.get().baseUrl,this.root.endsWith("/")&&(this.root=this.root.replace(/\/*$/,""))}urlForAnswerEdit(e,t,r){return"".concat(this.root,"/t/").concat(e,"/").concat(t,"/answer/").concat(r,"/edit")}urlForQuestion(e,t){return"".concat(this.root,"/t/").concat(e,"/").concat(t)}urlForQuestionEdit(e,t){return"".concat(this.root,"/t/").concat(e,"/").concat(t,"/edit")}urlForTopic(e){return"".concat(this.root,"/t/").concat(e)}urlForTopicEdit(e){return"".concat(this.root,"/t/").concat(e,"/edit")}urlForTopicAddQuestion(e){return"".concat(this.root,"/t/").concat(e,"/ask")}urlForQuestionAnswer(e,t){return"".concat(this.root,"/t/").concat(e,"/").concat(t,"/answer")}urlForHelp(){return"".concat(this.root,"/help")}urlForRoot(){return"".concat(this.root)}urlForLogout(){return"".concat(this.root,"/logout")}urlForSelfProfile(){return"".concat(this.root,"/self")}urlForTopicQuery(e,t){return"".concat(this.root,"/t/").concat(e,"/search/").concat(t)}redirect(e){window.location.href=e}}r(49);let H;!function(e){e[e.AddQuestion=0]="AddQuestion",e[e.View=1]="View",e[e.Edit=2]="Edit",e[e.None=3]="None"}(H||(H={}));class _ extends n.Component{constructor(e){super(e),this.nav=void 0,this.nav=new W}render(){if(!this.props.topic)return n.createElement(n.Fragment,null);const e=this.getUrl();return n.createElement("div",{className:"component--TopicLink"},n.createElement(o.b,{to:e},this.props.children))}getUrl(){switch(this.props.target){case H.AddQuestion:return this.nav.urlForTopicAddQuestion(this.props.topic);case H.View:return this.nav.urlForTopic(this.props.topic);case H.Edit:return this.nav.urlForTopicEdit(this.props.topic);case H.None:return this.nav.urlForRoot();default:throw new Error("Unsupported target")}}}r(54);const G=e=>{if(e.topicId){const t=e.description||"no description";return n.createElement("div",{className:"desc"},n.createElement(_,{target:H.Edit,topic:e.name},t))}return n.createElement("div",{className:"desc"})},J=e=>e.icon?n.createElement("div",{className:"icon"},n.createElement("img",{src:e.icon})):n.createElement(n.Fragment,null);class $ extends n.Component{render(){const e=this.props.name||"no topic",t=this.props.name?H.View:H.None;return n.createElement("div",{className:"component--TopicInfo"},n.createElement(J,this.props),n.createElement("div",null,n.createElement(_,{target:t,topic:e},n.createElement("h1",{className:"header"},e)),n.createElement(G,this.props)))}}r(55);class X extends n.Component{constructor(...e){super(...e),this.nav=new W}render(){return n.createElement("div",{className:"component--UserCurrentInfo"},n.createElement("div",null,n.createElement(o.b,{to:this.nav.urlForSelfProfile()},this.props.user.username)),n.createElement("div",{className:"logout"},n.createElement(o.b,{to:this.nav.urlForLogout()},"logout")))}}r(56);class Y extends n.PureComponent{render(){const e=j.get(),t=new W;return n.createElement("div",{className:"component--LayoutFooter"},n.createElement("div",null,n.createElement("div",{className:"message"},e.footerNotice),n.createElement("div",{className:"home"},n.createElement(o.b,{to:t.urlForRoot()},"Home")),n.createElement("div",{className:"help"},n.createElement(o.b,{to:t.urlForHelp()},"Help"))))}}r(57);class K extends n.Component{render(){const e=this.props.topic||(new B).state;return n.createElement(n.Fragment,null,n.createElement("div",{className:"component--LayoutStandardHeader"},n.createElement(S,{loading:this.props.loading}),n.createElement($,e),n.createElement(X,{user:this.props.user})),n.createElement(Y,null))}}r(58);let Z;!function(e){e[e.Answer=0]="Answer",e[e.View=1]="View",e[e.Edit=2]="Edit"}(Z||(Z={}));class ee extends n.Component{constructor(e){super(e),this.nav=void 0,this.nav=new W}render(){if(!this.props.question)return n.createElement(n.Fragment,null);const e=this.getUrl();return n.createElement(o.b,{to:e},this.props.children)}getUrl(){const e=this.props.question.state.topic,t=this.props.question.state.questionId;switch(this.props.target){case Z.View:return this.nav.urlForQuestion(e,t);case Z.Edit:return this.nav.urlForQuestionEdit(e,t);case Z.Answer:return this.nav.urlForQuestionAnswer(e,t);default:throw new Error("Unsupported target")}}}r(59);class te extends n.PureComponent{render(){return n.createElement("div",{className:"component--LayoutRightBottom"},this.props.children)}}class re extends n.PureComponent{render(){return this.props.show?n.createElement(n.Fragment,null,this.props.children):n.createElement(n.Fragment,null)}}r(60);class ne extends n.Component{constructor(...e){var t;super(...e),t=this,this.onVoteUp=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.props.userVotes){e.next=5;break}return e.next=3,t.props.onVote(0);case 3:e.next=7;break;case 5:return e.next=7,t.props.onVote(1);case 7:case"end":return e.stop()}}),e)}))),this.onVoteDown=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t.props.userVotes){e.next=5;break}return e.next=3,t.props.onVote(0);case 3:e.next=7;break;case 5:return e.next=7,t.props.onVote(-1);case 7:case"end":return e.stop()}}),e)}))),this.onStar=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.props.showStars&&t.props.onStar){e.next=2;break}return e.abrupt("return");case 2:if(!(t.props.userStars>0)){e.next=7;break}return e.next=5,t.props.onStar(0);case 5:e.next=9;break;case 7:return e.next=9,t.props.onStar(1);case 9:case"end":return e.stop()}}),e)})))}render(){const e=this.props.userVotes>0?["up","active"]:["up"],t=this.props.userVotes<0?["down","active"]:["down"],r=this.props.userStars>0?["star","active"]:["star"];return n.createElement("div",{className:"component--VotesAndStars"},n.createElement("li",null,n.createElement("div",{className:e.join(" "),onClick:this.onVoteUp})),n.createElement("li",null,n.createElement("div",{className:"votes"},this.props.votes)),n.createElement("li",null,n.createElement("div",{className:t.join(" "),onClick:this.onVoteDown})),n.createElement(re,{show:this.props.showStars},n.createElement("li",{className:"star-container"},n.createElement("div",{className:r.join(" "),onClick:this.onStar}))))}}r(61);class ae extends n.Component{constructor(e){super(e),this.nav=void 0,this.nav=new W}render(){const e=this.props.tags.map(e=>{if(null==this.props.topic)return n.createElement("div",{key:e,className:"tag"},e);const t=this.nav.urlForTopicQuery(this.props.topic,"tag:".concat(e));return n.createElement("div",{key:e,className:"tag"},n.createElement(o.b,{to:t},e))});return 0===e.length?n.createElement(n.Fragment,null):n.createElement("div",{className:"component--TagList"},this.props.tags.length>0?e:"No tags")}}r(62);class se extends n.PureComponent{render(){return n.createElement("div",{className:"component--UserSummary"},"by: ",this.props.user.state.username)}}r(63);class oe extends n.Component{constructor(...e){var t;super(...e),t=this,this.onVote=function(){var e=Object(p.a)(i.a.mark((function e(r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r>0)){e.next=5;break}return e.next=3,t.props.question.state.meta.voteUp();case 3:e.next=12;break;case 5:if(!(r<0)){e.next=10;break}return e.next=8,t.props.question.state.meta.voteDown();case 8:e.next=12;break;case 10:return e.next=12,t.props.question.state.meta.voteNeutral();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onStar=function(){var e=Object(p.a)(i.a.mark((function e(r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return e.next=3,t.props.question.state.meta.addStar();case 3:e.next=7;break;case 5:return e.next=7,t.props.question.state.meta.removeStar();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}render(){const e=this.props.question.state.meta;return n.createElement("div",{className:"component--QuestionView"},n.createElement("div",{className:"metadata"},n.createElement(ne,{showStars:!0,userStars:e.state.star?1:0,userVotes:e.state.votes,votes:e.state.global.votes,onVote:this.onVote,onStar:this.onStar})),n.createElement("div",{className:"output"},n.createElement("h2",null,this.props.question.state.title),n.createElement(ae,{tags:this.props.question.state.tags,topic:this.props.question.state.topic}),n.createElement(V,{markdown:this.props.question.state.body}),n.createElement(te,null,n.createElement(se,{user:this.props.question.state.user}))))}}class ce extends O{add(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/Answers/add",e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}delete(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/Answers/delete",{id:e});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}get(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/Answers/get",{id:e});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}getMetadata(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/Answers/metadata",{id:e});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}updateMetadata(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/Answers/updateMetadata",e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}update(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/Answers/update",e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}search(e,t,r){var n=this;return Object(p.a)(i.a.mark((function a(){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.post("/api/Answers/search",{limit:r,offset:t,questionId:e});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()}}class ue extends d{voteUp(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ce,t.next=3,r.updateMetadata(Object(s.a)({},e.state,{votes:1}));case 3:return t.next=5,r.getMetadata(e.state.answerId);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}voteNeutral(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ce,t.next=3,r.updateMetadata(Object(s.a)({},e.state,{votes:0}));case 3:return t.next=5,r.getMetadata(e.state.answerId);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}voteDown(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ce,t.next=3,r.updateMetadata(Object(s.a)({},e.state,{votes:-1}));case 3:return t.next=5,r.getMetadata(e.state.answerId);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}blank(){return{answerId:"",answerMetaId:"",global:{votes:0},rowVersion:"",votes:0}}rebind(){}}class ie{constructor(){this.pending=null,this.requests={}}static isExpired(e){return e.expires<Date.now()}get(e){const t=this.requests[e];return t?ie.isExpired(t)?(delete this.requests[e],null):t.value:null}set(e,t,r){this.requests[e]={expires:Date.now()+r,value:t}}waitPending(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.pending){t.next=3;break}return t.next=3,e.pending;case 3:case"end":return t.stop()}}),t)})))()}update(e){var t=this;return Object(p.a)(i.a.mark((function r(){var n;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=null,t.pending=new Promise(function(){var t=Object(p.a)(i.a.mark((function t(r,a){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:n=t.sent,r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,r){return t.apply(this,arguments)}}()),r.next=4,t.pending;case 4:if(null!=n){r.next=6;break}throw new Error("No data returned from cache update query");case 6:return r.abrupt("return",n);case 7:case"end":return r.stop()}}),r)})))()}}const pe=new ie;class le extends O{get(e){var t=this;return Object(p.a)(i.a.mark((function r(){var n,a;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n="/api/users/get::".concat(e),r.next=3,pe.waitPending();case 3:if(!(a=pe.get(n))){r.next=6;break}return r.abrupt("return",a);case 6:return r.next=8,pe.update(Object(p.a)(i.a.mark((function r(){var a;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/users/get",{id:e});case 2:return a=r.sent,pe.set(n,a,2e3),r.abrupt("return",a);case 5:case"end":return r.stop()}}),r)}))));case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}}),r)})))()}}class he extends d{static get(e){return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new he).state.userId=e,t.next=4,r.refresh();case 4:return t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()}reset(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.blank());case 1:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}refresh(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new le,t.next=3,r.get(e.state.userId);case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}blank(){return{userId:"",username:""}}rebind(){}}class de extends d{static get(e){return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new de).state.answerId=e,t.next=4,r.refresh();case 4:return t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()}static search(e,t=10,r=0){return R.fromQuery({fetchIds:de.searchForIds,fetchInstance:de.get,pageSize:t,query:e},r)}static searchForIds(e,t,r){return Object(p.a)(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new ce,n.next=3,a.search(e,t,r);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}refresh(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchAnswerData(e.state.answerId);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}reset(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.blank());case 1:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}save(){var e=this;return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ce,t.next=3,e.update(Object(p.a)(i.a.mark((function t(){var n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(delete(n=Object(s.a)({},e.state)).meta,delete n.user,e.state.answerId){t.next=10;break}return t.next=6,r.add(n);case 6:return a=t.sent,t.next=9,e.fetchAnswerData(a.answerId);case 9:return t.abrupt("return",t.sent);case 10:return t.next=12,r.update(n);case 12:return t.next=14,e.fetchAnswerData(e.state.answerId);case 14:return t.abrupt("return",t.sent);case 15:case"end":return t.stop()}}),t)}))));case 3:case"end":return t.stop()}}),t)})))()}delete(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ce,t.next=3,r.delete(e.state.answerId);case 3:return t.abrupt("return",e.blank());case 4:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}blank(){return{answerId:"",body:"...",canEdit:!1,meta:new ue,questionId:"",rowVersion:"",user:new he,userId:""}}fetchAnswerData(e){return Object(p.a)(i.a.mark((function t(){var r,n,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ce,t.next=3,r.get(e);case 3:return n=t.sent,t.t0=ue,t.next=7,r.getMetadata(e);case 7:return t.t1=t.sent,a=new t.t0(t.t1),t.next=11,he.get(n.userId);case 11:return o=t.sent,t.abrupt("return",Object(s.a)({},n,{meta:a,user:o}));case 13:case"end":return t.stop()}}),t)})))()}rebind(){this.state.meta.parent=this}}class me extends O{add(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/questions/add",e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}delete(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/questions/delete",{id:e});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}get(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/questions/get",{id:e});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}getMetadata(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/questions/metadata",{id:e});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}getSummary(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/questions/getSummary",{id:e});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}updateMetadata(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/questions/updateMetadata",e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}update(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.post("/api/questions/update",e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}search(e,t,r){var n=this;return Object(p.a)(i.a.mark((function a(){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.post("/api/questions/search",{limit:r,offset:t,query:e});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()}}class fe extends d{voteUp(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,r.updateMetadata(Object(s.a)({},e.state,{votes:1}));case 3:return t.next=5,r.getMetadata(e.state.questionId);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}voteNeutral(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,r.updateMetadata(Object(s.a)({},e.state,{votes:0}));case 3:return t.next=5,r.getMetadata(e.state.questionId);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}voteDown(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,r.updateMetadata(Object(s.a)({},e.state,{votes:-1}));case 3:return t.next=5,r.getMetadata(e.state.questionId);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}addStar(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,r.updateMetadata(Object(s.a)({},e.state,{star:!0}));case 3:return t.next=5,r.getMetadata(e.state.questionId);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}removeStar(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,r.updateMetadata(Object(s.a)({},e.state,{star:!1}));case 3:return t.next=5,r.getMetadata(e.state.questionId);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}blank(){return{global:{votes:0},questionId:"",questionMetaId:"",rowVersion:"",star:!1,votes:0}}rebind(){}}class ve extends d{static get(e){return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new ve).state.questionId=e,t.next=4,r.refresh();case 4:return t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()}static search(e,t=10,r=0){return R.fromQuery({fetchIds:ve.searchForIds,fetchInstance:ve.get,pageSize:t,query:e},r)}static searchForIds(e,t,r){return Object(p.a)(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new me,n.next=3,a.search(e,t,r);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}delete(){var e=this;return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.delete(e.state.questionId);case 2:return t.abrupt("return",{questionId:"",rowVersion:""});case 3:case"end":return t.stop()}}),t)}))));case 3:case"end":return t.stop()}}),t)})))()}refresh(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchQuestionData(e.state.questionId);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}reset(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.blank());case 1:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}save(){var e=this;return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,e.update(Object(p.a)(i.a.mark((function t(){var n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(delete(n=Object(s.a)({},e.state)).meta,delete n.user,e.state.questionId){t.next=10;break}return t.next=6,r.add(n);case 6:return a=t.sent,t.next=9,e.fetchQuestionData(a.questionId);case 9:return t.abrupt("return",t.sent);case 10:return t.next=12,r.update(n);case 12:return t.next=14,e.fetchQuestionData(e.state.questionId);case 14:return t.abrupt("return",t.sent);case 15:case"end":return t.stop()}}),t)}))));case 3:case"end":return t.stop()}}),t)})))()}blank(){return{body:"...",canEdit:!1,meta:new fe,questionId:"",rowVersion:"",tags:[],title:"new question",topic:"default",user:new he,userId:""}}fetchQuestionData(e){return Object(p.a)(i.a.mark((function t(){var r,n,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,r.get(e);case 3:return n=t.sent,t.t0=fe,t.next=7,r.getMetadata(e);case 7:return t.t1=t.sent,a=new t.t0(t.t1),t.next=11,he.get(n.userId);case 11:return o=t.sent,t.abrupt("return",Object(s.a)({},n,{meta:a,user:o}));case 13:case"end":return t.stop()}}),t)})))()}rebind(){this.state.meta.parent=this}}class we extends d{constructor(e){super(),this.isLoaded=!1,this.unsubscribe=void 0,this.unsubscribe=this.subscribe(()=>{e()})}load(e){var t=this;this.isLoaded=!0,this.runAsync(Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.loadInitialData(e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)}))))}unload(){this.isLoaded&&(this.isLoaded=!1,this.unsubscribe())}runAsync(e){setTimeout(()=>{e().then(()=>{},e=>{w.get().error(e)})},1)}}class xe extends we{answerQuestion(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:null}));case 1:case"end":return e.stop()}}),e)}))));case 2:return t.next=4,e.state.answer.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{questionId:e.state.question.state.questionId});case 1:case"end":return t.stop()}}),t)}))));case 4:return t.next=6,e.state.answer.save();case 6:if(null!==e.state.answer.error){t.next=9;break}return t.next=9,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:"Saved answer"}));case 1:case"end":return e.stop()}}),e)}))));case 9:case"end":return t.stop()}}),t)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.get(e.topic);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return t.next=7,ve.get(e.question);case 7:if(!(n=t.sent).error){t.next=10;break}throw n.error;case 10:return t.abrupt("return",{question:n,topic:r,answer:new de});case 11:case"end":return t.stop()}}),t)}))));case 2:case"end":return r.stop()}}),r)})))()}blank(){return{answer:new de,notice:null,question:new ve,topic:new B}}rebind(){this.state.topic.parent=this,this.state.question.parent=this,this.state.answer.parent=this}}class be extends n.Component{constructor(e){super(e),this.data=void 0,this.answerQuestionEvent=()=>this.data.answerQuestion(),this.data=new xe(()=>this.forceUpdate())}componentDidMount(){this.data.unload(),this.data=new xe(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}render(){if(!this.guardInvalidState())return"";const e=this.data.state.question,t=this.data.state.answer,r=this.data.state.topic;return n.createElement("div",{className:"component--TopicHomePage"},n.createElement(K,{user:this.props.user.state,topic:r.state,loading:this.data.updating}),n.createElement(I,null,n.createElement(T,{expand:!1},n.createElement(ee,{question:e,target:Z.View},"View full question")),n.createElement(oe,{question:e})),n.createElement(y,{error:this.data.state.question.error},n.createElement(z,{value:this.data.state.notice}),n.createElement(L,{submit:this.answerQuestionEvent,answer:t,saveText:"Save"})))}guardInvalidState(){return null!==this.data}}r(64);class ge extends n.Component{constructor(e){super(e),this.toggleOpenState=()=>{this.setState({open:!this.state.open})},this.state={open:!1}}render(){return this.state.open?n.createElement("div",{className:"component--LayoutUnsafeBox"},n.createElement("div",{className:"header",onClick:this.toggleOpenState},this.props.title),this.props.children):n.createElement("div",{className:"component--LayoutUnsafeBox"},n.createElement("div",{className:"header",onClick:this.toggleOpenState},this.props.title))}}class Ee extends n.Component{constructor(...e){super(...e),this.auth=new C}render(){return n.createElement(n.Fragment,null,this.authorized()?this.props.children:n.createElement(n.Fragment,null))}authorized(){return this.auth.hasPermissions(this.props.user,this.props.requirePermissions)}}class ke extends n.Component{render(){return n.createElement(Ee,{user:this.props.user,requirePermissions:this.props.permissions},n.createElement(I,null,n.createElement(ge,{title:"Unsafe commands"},n.createElement("form",null,n.createElement("fieldset",null,this.props.children)))))}}class je extends we{saveAnswer(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:null}));case 1:case"end":return e.stop()}}),e)}))));case 2:return t.next=4,e.state.answer.save();case 4:if(null!==e.state.answer.error){t.next=7;break}return t.next=7,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:"Saved answer"}));case 1:case"end":return e.stop()}}),e)}))));case 7:case"end":return t.stop()}}),t)})))()}deleteAnswer(){var e=this;return Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.answer.delete();case 2:r=new W,n=e.state.question,r.redirect(r.urlForQuestion(n.state.topic,n.state.questionId));case 5:case"end":return t.stop()}}),t)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){var r,n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.get(e.topic);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return t.next=7,ve.get(e.question);case 7:if(!(n=t.sent).error){t.next=10;break}throw n.error;case 10:return t.next=12,de.get(e.answer);case 12:if(!(a=t.sent).error){t.next=15;break}throw a.error;case 15:if(a.state.questionId===n.state.questionId){t.next=17;break}throw new Error("Invalid answer id for topic");case 17:return t.abrupt("return",{question:n,topic:r,answer:a});case 18:case"end":return t.stop()}}),t)}))));case 2:case"end":return r.stop()}}),r)})))()}blank(){return{answer:new de,notice:null,question:new ve,topic:new B}}rebind(){this.state.topic.parent=this,this.state.question.parent=this,this.state.answer.parent=this}}class Oe extends n.Component{constructor(e){var t;super(e),t=this,this.data=void 0,this.saveAnswerEvent=()=>this.data.saveAnswer(),this.onDeleteQuestion=function(){var e=Object(p.a)(i.a.mark((function e(r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t.data.deleteAnswer();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.data=new je(()=>this.forceUpdate())}componentDidMount(){this.data.unload(),this.data=new je(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}render(){if(!this.guardInvalidState())return"";const e=this.data.state.question,t=this.data.state.answer,r=this.data.state.topic;return n.createElement("div",{className:"component--TopicHomePage"},n.createElement(K,{user:this.props.user.state,topic:r.state,loading:this.data.updating}),n.createElement(I,null,n.createElement(oe,{question:e})),n.createElement(y,{error:this.data.state.answer.error},n.createElement(T,{expand:!0},n.createElement(ee,{question:e,target:Z.View},"Close")),n.createElement(z,{value:this.data.state.notice}),n.createElement(L,{submit:this.saveAnswerEvent,answer:t,saveText:"Save"})),n.createElement(ke,{user:this.props.user,permissions:["CanDelete:Answer"]},n.createElement(T,{expand:!0},n.createElement("p",null,"Delete this answer?"),n.createElement("p",null,"Careful! No undo for this!"),n.createElement("button",{onClick:this.onDeleteQuestion},"Delete answer"))))}guardInvalidState(){return null!==this.data}}r(65);const qe=e=>n.createElement("div",{className:"tip"},e.children);class Ce extends n.Component{render(){const e=new W;return n.createElement("div",{className:"component--TopicHomePage"},n.createElement(I,null,n.createElement("h1",null,"Help"),n.createElement(qe,null,"To start a new topic, just go to ",e.urlForTopic("NAME")),n.createElement(qe,null,"Searching for tags:",n.createElement("code",null,"tag:name tag:name2 some search")),n.createElement(qe,null,"Searching for anything in a topic:",n.createElement("code",null,"topic:name *")),n.createElement(qe,null,"Searching in multiple topics:",n.createElement("code",null,"topic:name topic:other query")),n.createElement(qe,null,"Searching in any topic:",n.createElement("code",null,"topic:* query"))),n.createElement(Y,null))}}r(66);class Se extends n.Component{constructor(e){var t;super(e),t=this,this.onLogout=Object(p.a)(i.a.mark((function e(){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.props.user,t.setState({redirect:!0},Object(p.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new C,e.next=3,t.logout(r);case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))),this.state={redirect:!1}}render(){return this.state.redirect?n.createElement(c.a,{to:(new W).urlForRoot()}):n.createElement("div",{className:"component--GenericLogoutPage"},n.createElement(K,{user:this.props.user.state,topic:null,loading:this.props.user.updating}),n.createElement(I,null,n.createElement("h3",{className:"notice"},"Logout?"),n.createElement("p",null,"Are you sure? Your current session will be abandoned.")),n.createElement(I,null,n.createElement(T,{expand:!0},n.createElement("button",{onClick:this.onLogout},"Logout"))))}}class Ie extends n.Component{static getDerivedStateFromProps(e,t){return e.value!==t.lastPropValue?{value:e.value,lastPropValue:e.value}:null}constructor(e){super(e),this.events={},this.state={lastPropValue:"",value:""},this.events={onChange:e=>this.onChange(e)}}render(){return n.createElement("input",{value:this.state.value,onChange:this.events.onChange})}onChange(e){const t=e.currentTarget.value;this.setState({value:t},()=>{this.props.onChange(t)})}}r(67);class Ne extends n.Component{static getDerivedStateFromProps(e,t){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0}(e.value,t.lastTags)?null:{tagEditValue:e.value.join(", "),lastTags:e.value}}static onlyUnique(e,t,r){return r.indexOf(e)===t}constructor(e){super(e),this.onTagsChangedEvent=void 0,this.state={lastTags:[],tagEditValue:""},this.onTagsChangedEvent=e=>this.onTagsChanged(e)}render(){return n.createElement("div",{className:"component--TagPicker"},n.createElement(Ie,{value:this.state.tagEditValue,onChange:this.onTagsChangedEvent}),n.createElement("div",{className:"rendered"},n.createElement(ae,{tags:this.props.value,topic:null})))}onTagsChanged(e){this.setState({tagEditValue:e},()=>{const t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0).filter(Ne.onlyUnique);this.props.onChange(t)})}}class ye extends n.Component{constructor(e){super(e),this.onSaveEvent=void 0,this.onTitleChangedEvent=void 0,this.onTagsChangedEvent=void 0,this.onBodyChangedEvent=void 0,this.onTopicChanged=e=>{this.props.question.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{topic:e});case 1:case"end":return t.stop()}}),t)}))))},this.onBodyChangedEvent=e=>this.onBodyChanged(e),this.onSaveEvent=e=>this.onSave(e),this.onTagsChangedEvent=e=>this.onTagsChanged(e),this.onTitleChangedEvent=e=>this.onTitleChanged(e)}render(){return n.createElement("div",{className:"component--Question"},n.createElement("form",{action:"",onSubmit:this.onSaveEvent},n.createElement(re,{show:this.props.showTopic},n.createElement("fieldset",null,n.createElement(Ie,{value:this.props.question.state.topic,onChange:this.onTopicChanged}))),n.createElement("fieldset",null,n.createElement(Ie,{value:this.props.question.state.title,onChange:this.onTitleChangedEvent})),n.createElement("fieldset",null,n.createElement(A,{value:this.props.question.state.body,onChange:this.onBodyChangedEvent})),n.createElement("fieldset",null,n.createElement(Ne,{value:this.props.question.state.tags,onChange:this.onTagsChangedEvent})),n.createElement("fieldset",{className:"buttons"},n.createElement("button",{className:"submit"},this.props.saveText))))}onSave(e){e.preventDefault(),this.props.submit()}onTitleChanged(e){this.props.question.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{title:e});case 1:case"end":return t.stop()}}),t)}))))}onTagsChanged(e){this.props.question.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{tags:e});case 1:case"end":return t.stop()}}),t)}))))}onBodyChanged(e){this.props.question.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{body:e});case 1:case"end":return t.stop()}}),t)}))))}}class Te extends we{askQuestion(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:null}));case 1:case"end":return e.stop()}}),e)}))));case 2:return t.next=4,e.state.question.save();case 4:if(null!==e.state.question.error){t.next=7;break}return t.next=7,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:"Saved question"}));case 1:case"end":return e.stop()}}),e)}))));case 7:case"end":return t.stop()}}),t)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.get(e.topic);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return n=new ve,t.next=8,n.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{topic:r.state.name});case 1:case"end":return e.stop()}}),e)}))));case 8:return t.abrupt("return",{question:n,topic:r});case 9:case"end":return t.stop()}}),t)}))));case 2:case"end":return r.stop()}}),r)})))()}blank(){return{notice:null,question:new ve,topic:new B}}rebind(){this.state.topic.parent=this,this.state.question.parent=this}}class De extends n.Component{constructor(e){super(e),this.data=void 0,this.askQuestion=()=>this.data.askQuestion(),this.data=new Te(()=>this.forceUpdate())}componentDidMount(){this.data.unload(),this.data=new Te(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}render(){if(!this.guardInvalidState())return"";const e=this.data.state.question,t=this.data.state.topic;return n.createElement("div",{className:"component--TopicHomePage"},n.createElement(K,{user:this.props.user.state,topic:t.state,loading:this.data.updating}),n.createElement(y,{error:this.data.state.question.error},n.createElement(re,{show:e.state.questionId},n.createElement(T,{expand:!0},n.createElement(ee,{question:e,target:Z.View},"View"))),n.createElement(z,{value:this.data.state.notice}),n.createElement(ye,{showTopic:!1,submit:this.askQuestion,question:e,saveText:"Save"})))}guardInvalidState(){return null!==this.data}}class Pe extends we{updateQuestion(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:null}));case 1:case"end":return e.stop()}}),e)}))));case 2:return t.next=4,e.state.question.save();case 4:if(null!==e.state.question.error){t.next=7;break}return t.next=7,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:"Saved question"}));case 1:case"end":return e.stop()}}),e)}))));case 7:case"end":return t.stop()}}),t)})))()}deleteQuestion(){var e=this;return Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.question.delete();case 2:r=new W,n=r.urlForTopic(e.state.topic.state.name),r.redirect(n);case 5:case"end":return t.stop()}}),t)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.get(e.topic);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return t.next=7,ve.get(e.question);case 7:if(!(n=t.sent).error){t.next=10;break}throw n.error;case 10:return t.abrupt("return",{question:n,topic:r});case 11:case"end":return t.stop()}}),t)}))));case 2:case"end":return r.stop()}}),r)})))()}blank(){return{notice:null,question:new ve,topic:new B}}rebind(){this.state.topic.parent=this,this.state.question.parent=this}}class Fe extends n.Component{constructor(e){var t;super(e),t=this,this.data=void 0,this.onUpdateQuestionEvent=()=>this.data.updateQuestion(),this.onDeleteQuestion=function(){var e=Object(p.a)(i.a.mark((function e(r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t.data.deleteQuestion();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.data=new Pe(()=>this.forceUpdate())}componentDidMount(){this.data.unload(),this.data=new Pe(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}render(){if(!this.guardInvalidState())return"";const e=this.data.state.question,t=this.data.state.topic;return n.createElement("div",{className:"component--TopicHomePage"},n.createElement(K,{user:this.props.user.state,topic:t.state,loading:this.data.updating}),n.createElement(y,{error:this.data.state.question.error},n.createElement(T,{expand:!0},n.createElement(ee,{question:e,target:Z.View},"Close")),n.createElement(z,{value:this.data.state.notice}),n.createElement(ye,{showTopic:!0,submit:this.onUpdateQuestionEvent,question:e,saveText:"Save"})),n.createElement(ke,{user:this.props.user,permissions:["CanDelete:Question"]},n.createElement(T,{expand:!0},n.createElement("p",null,"Delete this question?"),n.createElement("p",null,"Careful! No undo for this!"),n.createElement("button",{onClick:this.onDeleteQuestion},"Delete question"))))}guardInvalidState(){return null!==this.data}}r(68);let Ue;!function(e){e[e.Edit=0]="Edit"}(Ue||(Ue={}));class Qe extends n.Component{constructor(e){super(e),this.nav=void 0,this.nav=new W}render(){if(!this.props.question.state.questionId)return n.createElement(n.Fragment,null);const e=this.getUrl();return n.createElement("div",{className:"component--AnswerLink"},n.createElement("a",{href:e},this.props.children))}getUrl(){switch(this.props.target){case Ue.Edit:return this.nav.urlForAnswerEdit(this.props.question.state.topic,this.props.question.state.questionId,this.props.answer.state.answerId);default:throw new Error("Unsupported target")}}}r(69);class Ve extends n.Component{constructor(...e){var t;super(...e),t=this,this.onVote=function(){var e=Object(p.a)(i.a.mark((function e(r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r>0)){e.next=5;break}return e.next=3,t.props.answer.state.meta.voteUp();case 3:e.next=12;break;case 5:if(!(r<0)){e.next=10;break}return e.next=8,t.props.answer.state.meta.voteDown();case 8:e.next=12;break;case 10:return e.next=12,t.props.answer.state.meta.voteNeutral();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}render(){const e=this.props.answer.state.meta;return n.createElement("div",{className:"component--AnswerView"},n.createElement(re,{show:this.props.answer.state.canEdit},n.createElement(T,{expand:!1},n.createElement(Qe,{question:this.props.question,answer:this.props.answer,target:Ue.Edit},"Edit"))),n.createElement("div",{className:"metadata"},n.createElement(ne,{showStars:!1,userStars:0,userVotes:e.state.votes,votes:e.state.global.votes,onVote:this.onVote,onStar:null})),n.createElement("div",{className:"output"},n.createElement("div",{className:"rendered"},n.createElement(V,{markdown:this.props.answer.state.body})),n.createElement(te,null,n.createElement(se,{user:this.props.answer.state.user}))))}}class Ae extends n.Component{render(){return n.createElement("div",{className:"component--AnswerList"},this.renderAnswerList())}renderAnswerList(){return null==this.props.answers.state.instances?[]:this.props.answers.state.instances.map(e=>n.createElement(I,{key:e.state.answerId},n.createElement(Ve,{answer:e,question:this.props.question,topic:this.props.topic})))}}r(70);class Le extends n.PureComponent{constructor(...e){super(...e),this.onChangeSize=e=>{const t=Number(e.currentTarget.value);this.props.onChangeSize(t)}}render(){const e=this.props.allowedSizes.map(e=>n.createElement("option",{key:e},e));return n.createElement("div",{className:"component--QuerySetPaginator"},n.createElement(N,{error:this.props.error}),n.createElement(I,null,n.createElement("div",{className:"parts"},n.createElement("div",{className:"part"},"Results per page:",n.createElement("select",{value:this.props.queryState.pageSize,onChange:this.onChangeSize},e)),n.createElement("div",{className:"part buttons"},n.createElement("div",null,n.createElement(re,{show:this.props.queryState.page>0},n.createElement("button",{onClick:this.props.onPrev},"Prev")),n.createElement(re,{show:this.props.queryState.moreResults},n.createElement("button",{onClick:this.props.onNext},"Next")))))))}}class ze extends we{next(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.answers.next();case 2:return t.abrupt("return",null);case 3:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}prev(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.answers.prev();case 2:return t.abrupt("return",null);case 3:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}setPageSize(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{pageSize:e});case 1:case"end":return t.stop()}}),t)}))));case 2:return r.next=4,t.refreshData();case 4:case"end":return r.stop()}}),r)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.get(e.topic);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return t.next=7,ve.get(e.question);case 7:if(!(n=t.sent).error){t.next=10;break}throw n.error;case 10:return t.abrupt("return",{question:n,topic:r});case 11:case"end":return t.stop()}}),t)}))));case 2:return r.next=4,t.refreshData();case 4:case"end":return r.stop()}}),r)})))()}blank(){return{answers:new R,notice:null,pageSize:5,question:new ve,topic:new B}}rebind(){this.state.topic.parent=this,this.state.question.parent=this,this.state.answers.parent=this}refreshData(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.state.question,t.next=3,de.search(r.state.questionId,e.state.pageSize);case 3:return n=t.sent,t.abrupt("return",{answers:n});case 5:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}}class Me extends n.Component{constructor(e){super(e),this.data=void 0,this.onChangeSize=e=>this.data.setPageSize(e),this.onNext=()=>this.data.next(),this.onPrev=()=>this.data.prev(),this.data=new ze(()=>this.forceUpdate())}componentDidMount(){this.data.unload(),this.data=new ze(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}render(){if(!this.guardInvalidState())return"";const e=this.data.state.question,t=this.data.state.answers,r=this.data.state.topic;return n.createElement("div",{className:"component--TopicViewQuestionPage"},n.createElement(K,{user:this.props.user.state,topic:r.state,loading:this.data.updating}),n.createElement(I,null,n.createElement(T,{expand:!1},n.createElement(re,{show:e.state.canEdit},n.createElement(ee,{question:e,target:Z.Edit},"Edit")),n.createElement(_,{topic:e.state.topic,target:H.View},"Close")),n.createElement(oe,{question:e})),n.createElement(Ae,{topic:this.data.state.topic,question:this.data.state.question,answers:this.data.state.answers}),n.createElement(Le,{allowedSizes:[1,5,10,25],queryState:t.state,onChangeSize:this.onChangeSize,onNext:this.onNext,onPrev:this.onPrev,error:t.error}),n.createElement(I,null,n.createElement(T,{expand:!0},n.createElement(ee,{question:e,target:Z.Answer},n.createElement("button",null,"Answer Question")))))}guardInvalidState(){return null!==this.data}}var Re=r(81);r(71);class Be extends n.Component{constructor(e){var t;super(e),t=this,this.searchStream=new l.a,this.onChangeEvent=e=>this.searchStream.next(e),this.searchStream.pipe(Object(Re.a)(this.props.debounce)).subscribe(function(){var e=Object(p.a)(i.a.mark((function e(r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.props.onChange(r);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}render(){return n.createElement("div",{className:"component--SearchBar"},n.createElement(y,{error:this.props.error},n.createElement("form",null,n.createElement("fieldset",null,n.createElement(Ie,{value:this.props.value,onChange:this.onChangeEvent})))))}}Be.defaultProps={debounce:200};r(72);const We=e=>e.topic.state.icon?n.createElement("div",{className:"icon"},n.createElement("img",{src:e.topic.state.icon})):n.createElement(n.Fragment,null);class He extends n.Component{render(){const e=this.props.topic.state.description||"no description";return n.createElement("div",{className:"component--TopicView"},n.createElement(We,{topic:this.props.topic}),n.createElement("div",null,n.createElement("div",null,n.createElement(_,{topic:this.props.topic.state.name,target:H.View},n.createElement("h2",null,this.props.topic.state.name))),n.createElement("div",null,e)))}}r(73);class _e extends n.Component{constructor(e){super(e),this.state={page:0,pageSize:10}}render(){return n.createElement("div",{className:"component--TopicList"},this.renderList())}renderList(){return null==this.props.topics.state.instances?[]:this.props.topics.state.instances.map(e=>e.state.topicId?n.createElement("div",{className:"item",key:e.state.topicId},n.createElement(I,null,n.createElement(He,{topic:e}))):n.createElement(n.Fragment,null))}}class Ge extends d{static get(e){return Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new Ge).state.questionId=e,t.next=4,r.refresh();case 4:return t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()}static search(e,t=10,r=0){return R.fromQuery({fetchIds:Ge.searchForIds,fetchInstance:Ge.get,pageSize:t,query:e},r)}static searchForIds(e,t,r){return Object(p.a)(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new me,n.next=3,a.search(e,t,r);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}refresh(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchQuestionData(e.state.questionId);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}blank(){return{answer:null,canEdit:!1,meta:new fe,questionId:"",summary:"...",tags:[],title:"new answer",topic:"default",user:new he}}fetchQuestionData(e){return Object(p.a)(i.a.mark((function t(){var r,n,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new me,t.next=3,r.getSummary(e);case 3:return n=t.sent,t.t0=fe,t.next=7,r.getMetadata(e);case 7:return t.t1=t.sent,a=new t.t0(t.t1),t.next=11,he.get(n.userId);case 11:return o=t.sent,t.abrupt("return",Object(s.a)({},n,{meta:a,user:o}));case 13:case"end":return t.stop()}}),t)})))()}rebind(){this.state.meta.parent=this}}class Je extends we{constructor(e){super(e)}search(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{search:e});case 1:case"end":return t.stop()}}),t)}))));case 2:return r.next=4,t.update(Object(p.a)(i.a.mark((function t(){var r,n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.search(e);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return n="topic:* ".concat(e),t.next=8,Ge.search(n,10);case 8:if(!(a=t.sent).error){t.next=11;break}throw a.error;case 11:return t.abrupt("return",{topics:r,questions:a});case 12:case"end":return t.stop()}}),t)}))));case 4:case"end":return r.stop()}}),r)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.search(e.search);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return t.abrupt("return",{topics:r,search:e.search});case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return r.stop()}}),r)})))()}blank(){return{search:"",topics:new R,questions:new R}}rebind(){this.state.topics.parent=this}}r(74);class $e extends n.Component{render(){const e=this.props.userVotes>0?["up","active"]:["up"],t=this.props.userVotes<0?["down","active"]:["down"],r=this.props.userStars>0?["star","active"]:["star"];return n.createElement("div",{className:"component--VotesAndStarsReadonly"},n.createElement("li",null,n.createElement("div",{className:e.join(" ")})),n.createElement("li",null,n.createElement("div",{className:"votes"},this.props.votes)),n.createElement("li",null,n.createElement("div",{className:t.join(" ")})),n.createElement("li",{className:"star-container"},n.createElement("div",{className:r.join(" ")})))}}r(75);class Xe extends n.Component{render(){const e=this.props.question.state.meta;return n.createElement("div",{className:"component--QuestionSummaryView"},n.createElement("div",{className:"metadata"},n.createElement($e,{userStars:e.state.star?1:0,userVotes:e.state.votes,votes:e.state.global.votes})),n.createElement("div",{className:"output"},n.createElement(ee,{question:this.props.question,target:Z.View},n.createElement("h2",null,this.props.question.state.title)),n.createElement(ae,{tags:this.props.question.state.tags,topic:this.props.question.state.topic}),n.createElement(V,{markdown:this.props.question.state.summary}),this.renderAnswer(),n.createElement(te,null,n.createElement(se,{user:this.props.question.state.user}))))}renderAnswer(){return this.props.question.state.answer?n.createElement("div",{className:"answer"},n.createElement(V,{markdown:this.props.question.state.answer})):n.createElement(n.Fragment,null)}}r(76);class Ye extends n.Component{constructor(e){super(e),this.state={page:0,pageSize:10}}render(){return n.createElement("div",{className:"component--QuestionSummaryList"},this.renderList())}renderList(){return null===this.props.questions.state.instances||0===this.props.questions.state.instances.length?this.props.showEmpty?n.createElement(I,null,"No questions found"):n.createElement(n.Fragment,null):this.props.questions.state.instances.map(e=>e.state.questionId?n.createElement(I,{key:e.state.questionId},n.createElement(Xe,{question:e})):n.createElement(n.Fragment,null))}}class Ke extends n.Component{constructor(e){super(e),this.data=void 0,this.onSearchEvent=e=>this.onSearch(e),this.data=new Je(()=>this.forceUpdate())}componentDidMount(){this.data.unload(),this.data=new Je(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}render(){if(!this.guardInvalidState())return n.createElement(n.Fragment,null);const e=this.data.state.search,t=this.data.state.topics,r=this.data.state.questions;return n.createElement("div",{className:"component--TopicDiscoverPage"},n.createElement(K,{user:this.props.user.state,topic:null,loading:this.data.updating}),n.createElement(Be,{value:e,onChange:this.onSearchEvent,error:this.data.error}),n.createElement(_e,{topics:t}),n.createElement(Ye,{questions:r,showEmpty:!1}))}guardInvalidState(){return null!==this.data}onSearch(e){this.data.search(e)}}r(77);const Ze=e=>e.value?n.createElement("img",{src:e.value}):n.createElement(n.Fragment,null);class et extends n.Component{static getDerivedStateFromProps(e,t){return e.value!==t.lastPropValue?{value:e.value,lastPropValue:e.value}:null}constructor(e){super(e),this.onChangeEvent=e=>this.onChange(e),this.state={lastPropValue:"",loaded:0,loading:!1,total:0,value:""}}render(){return n.createElement("div",{className:"component--InlineImgEditor"},n.createElement("div",{className:"preview"},n.createElement(Ze,this.props)),this.state.loading?n.createElement("div",{className:"progress"},this.state.loaded," / ",this.state.total):n.createElement(n.Fragment,null),n.createElement("input",{type:"file",onChange:this.onChangeEvent}))}onChange(e){if(e.currentTarget.files&&e.currentTarget.files.length>0){const t=e.currentTarget.files[0],r=new FileReader;this.setState({loading:!0},()=>{r.onloadend=e=>{const t=r.result;this.setState({loaded:e.loaded,loading:!1,total:e.total,value:t},()=>{this.props.onChange(t)})},r.onprogress=e=>{this.setState({loaded:e.loaded,total:e.total})},r.readAsDataURL(t)})}}}class tt extends n.Component{constructor(...e){super(...e),this.onDescChangedEvent=e=>this.onDescChanged(e),this.onIconChangedEvent=e=>this.onIconChanged(e),this.onSaveEvent=e=>this.onSave(e)}render(){return n.createElement("div",{className:"component--Question"},n.createElement("form",{action:"",onSubmit:this.onSaveEvent},n.createElement("fieldset",null,n.createElement(Ie,{value:this.props.topic.state.description,onChange:this.onDescChangedEvent})),n.createElement("fieldset",null,n.createElement(et,{value:this.props.topic.state.icon,onChange:this.onIconChangedEvent})),n.createElement("fieldset",{className:"buttons"},n.createElement("button",{className:"submit"},this.props.saveText))))}onSave(e){e.preventDefault(),this.props.submit()}onDescChanged(e){this.props.topic.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{description:e});case 1:case"end":return t.stop()}}),t)}))))}onIconChanged(e){this.props.topic.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{icon:e});case 1:case"end":return t.stop()}}),t)}))))}}class rt extends we{saveTopic(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:null}));case 1:case"end":return e.stop()}}),e)}))));case 2:return t.next=4,e.state.topic.save();case 4:if(null!==e.state.topic.error){t.next=7;break}return t.next=7,e.update(Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({notice:"Saved topic"}));case 1:case"end":return e.stop()}}),e)}))));case 7:case"end":return t.stop()}}),t)})))()}deleteTopic(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.topic.delete();case 2:case"end":return t.stop()}}),t)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.get(e.topic);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return t.abrupt("return",{topic:r});case 6:case"end":return t.stop()}}),t)}))));case 2:case"end":return r.stop()}}),r)})))()}blank(){return{notice:null,topic:new B}}rebind(){this.state.topic.parent=this}}class nt extends n.Component{constructor(e){var t;super(e),t=this,this.data=void 0,this.redirect=void 0,this.onSubmitFormEvent=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.data.saveTopic();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.onDeleteTopic=function(){var e=Object(p.a)(i.a.mark((function e(r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t.data.deleteTopic();case 3:t.data.state.topic.error||(t.redirect=!0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.redirect=!1,this.data=new rt(()=>this.forceUpdate())}componentDidMount(){this.data.unload(),this.data=new rt(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}render(){if(this.redirect){const e=(new W).urlForRoot();return n.createElement(c.a,{to:e})}if(!this.guardInvalidState())return n.createElement(n.Fragment,null);const e=this.data.state.topic;return n.createElement("div",{className:"component--TopicHomePage"},n.createElement(K,{user:this.props.user.state,topic:e.state,loading:this.data.updating}),n.createElement(y,{error:this.data.state.topic.error},n.createElement(z,{value:this.data.state.notice}),n.createElement(tt,{submit:this.onSubmitFormEvent,topic:e,saveText:"Save"})),n.createElement(Ee,{user:this.props.user,requirePermissions:["CanDelete:Topic"]},n.createElement(I,null,n.createElement(ge,{title:"Unsafe commands"},n.createElement("form",null,n.createElement("fieldset",null,n.createElement(T,{expand:!0},n.createElement("p",null,"Accidentally created this topic?"),n.createElement("p",null,"If it has no questions it can be deleted."),n.createElement("p",null,"Careful! No undo for this!"),n.createElement("button",{onClick:this.onDeleteTopic},"Delete topic"))))))))}guardInvalidState(){return null!==this.data}}class at extends we{constructor(e){super(e)}search(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{search:e});case 1:case"end":return t.stop()}}),t)}))));case 2:return r.next=4,t.refreshData();case 4:case"end":return r.stop()}}),r)})))()}next(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.questions.next();case 2:case"end":return t.stop()}}),t)})))()}prev(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.questions.prev();case 2:case"end":return t.stop()}}),t)})))()}setPageSize(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{pageSize:e});case 1:case"end":return t.stop()}}),t)}))));case 2:return r.next=4,t.refreshData();case 4:case"end":return r.stop()}}),r)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.get(e.topic);case 2:if(!(r=t.sent).error){t.next=5;break}throw r.error;case 5:return t.abrupt("return",{topic:r,search:e.search});case 6:case"end":return t.stop()}}),t)}))));case 2:return r.next=4,t.refreshData();case 4:case"end":return r.stop()}}),r)})))()}refreshData(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="topic:".concat(e.state.topic.state.name," ").concat(e.state.search),t.next=3,Ge.search(r,e.state.pageSize);case 3:if(!(n=t.sent).error){t.next=6;break}throw n.error;case 6:return t.abrupt("return",{questions:n});case 7:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}blank(){return{pageSize:5,questions:new R,search:"",topic:new B}}rebind(){this.state.topic.parent=this,this.state.questions.parent=this}}class st extends n.Component{constructor(e){super(e),this.data=void 0,this.onSearchEvent=e=>this.data.search(e),this.onChangeSize=e=>this.data.setPageSize(e),this.onNext=()=>this.data.next(),this.onPrev=()=>this.data.prev(),this.data=new at(()=>this.forceUpdate()),this.state={lastSearchProp:""}}componentDidMount(){this.data.unload(),this.data=new at(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}componentDidUpdate(e,t,r){this.props.search!==this.state.lastSearchProp&&this.setState({lastSearchProp:this.props.search},()=>{this.data.load(this.props)})}render(){if(!this.guardInvalidState())return n.createElement(n.Fragment,null);const e=this.data.state.questions,t=this.data.state.search,r=this.data.state.topic;return n.createElement("div",{className:"component--TopicSearchPage"},n.createElement(K,{user:this.props.user.state,topic:r.state,loading:this.data.updating}),n.createElement(Be,{error:this.data.error,value:t,onChange:this.onSearchEvent}),n.createElement(Ye,{questions:e,showEmpty:!0}),n.createElement(Le,{allowedSizes:[1,5,10,25],queryState:e.state,onChangeSize:this.onChangeSize,onNext:this.onNext,onPrev:this.onPrev,error:e.error}),n.createElement(I,null,n.createElement(T,{expand:!0},n.createElement(_,{target:H.AddQuestion,topic:this.props.topic},n.createElement("button",null,"Ask question")))))}guardInvalidState(){return null!==this.data}}class ot extends we{next(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.starQuestions.next();case 2:return t.abrupt("return",null);case 3:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}prev(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.starQuestions.prev();case 2:return t.abrupt("return",null);case 3:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}setPageSize(e){var t=this;return Object(p.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.update(Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{pageSize:e});case 1:case"end":return t.stop()}}),t)}))));case 2:return r.next=4,t.refreshData();case 4:case"end":return r.stop()}}),r)})))()}loadInitialData(e){var t=this;return Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshData();case 2:case"end":return e.stop()}}),e)})))()}blank(){return{pageSize:5,starQuestions:new R}}rebind(){this.state.starQuestions.parent=this}refreshData(){var e=this;return Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.update(Object(p.a)(i.a.mark((function t(){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ge.search("* topic:* is:star",e.state.pageSize);case 2:return r=t.sent,t.abrupt("return",{starQuestions:r});case 4:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()}}class ct extends n.Component{constructor(e){super(e),this.data=void 0,this.onChangeSize=e=>this.data.setPageSize(e),this.onNext=()=>this.data.next(),this.onPrev=()=>this.data.prev(),this.data=new ot(()=>this.forceUpdate())}componentDidMount(){this.data.unload(),this.data=new ot(()=>this.forceUpdate()),this.data.load(this.props)}componentWillUnmount(){this.data.unload()}render(){if(!this.guardInvalidState())return"";const e=this.data.state.starQuestions;return n.createElement("div",{className:"component--TopicHomePage"},n.createElement(K,{user:this.props.user.state,topic:null,loading:this.data.updating}),n.createElement("div",null,n.createElement(I,null,n.createElement("h3",null,"Marked questions")),n.createElement(Ye,{questions:e,showEmpty:!0}),n.createElement(Le,{allowedSizes:[1,5,10,25],queryState:e.state,onChangeSize:this.onChangeSize,onNext:this.onNext,onPrev:this.onPrev,error:e.error})))}guardInvalidState(){return null!==this.data}}class ut extends n.Component{constructor(...e){super(...e),this.help=()=>n.createElement(Ce,null),this.logout=()=>n.createElement(Se,{user:this.props.user}),this.self=()=>n.createElement(ct,{user:this.props.user}),this.discoverTopics=()=>n.createElement(Ke,{user:this.props.user,search:"*"}),this.searchTopicWithQuery=e=>n.createElement(st,{user:this.props.user,topic:e.match.params.name,search:e.match.params.query}),this.searchTopic=e=>n.createElement(st,{user:this.props.user,topic:e.match.params.name,search:"*"}),this.editTopic=e=>n.createElement(nt,{user:this.props.user,topic:e.match.params.name}),this.askQuestion=e=>n.createElement(De,{user:this.props.user,topic:e.match.params.name}),this.viewQuestion=e=>n.createElement(Me,{user:this.props.user,topic:e.match.params.name,question:e.match.params.questionId}),this.editQuestion=e=>n.createElement(Fe,{user:this.props.user,topic:e.match.params.name,question:e.match.params.questionId}),this.editAnswer=e=>n.createElement(Oe,{user:this.props.user,topic:e.match.params.name,question:e.match.params.questionId,answer:e.match.params.answerId}),this.answerQuestion=e=>n.createElement(be,{user:this.props.user,topic:e.match.params.name,question:e.match.params.questionId})}render(){return n.createElement(o.a,null,n.createElement(c.d,null,n.createElement(c.b,{exact:!0,path:"/",render:this.discoverTopics}),n.createElement(c.b,{exact:!0,path:"/help",render:this.help}),n.createElement(c.b,{exact:!0,path:"/self",render:this.self}),n.createElement(c.b,{exact:!0,path:"/logout",render:this.logout}),n.createElement(c.b,{exact:!0,path:"/t/:name",render:this.searchTopic}),n.createElement(c.b,{exact:!0,path:"/t/:name/search/:query",render:this.searchTopicWithQuery}),n.createElement(c.b,{exact:!0,path:"/t/:name/edit",render:this.editTopic}),n.createElement(c.b,{exact:!0,path:"/t/:name/ask",render:this.askQuestion}),n.createElement(c.b,{exact:!0,path:"/t/:name/:questionId",render:this.viewQuestion}),n.createElement(c.b,{exact:!0,path:"/t/:name/:questionId/edit",render:this.editQuestion}),n.createElement(c.b,{exact:!0,path:"/t/:name/:questionId/answer",render:this.answerQuestion}),n.createElement(c.b,{exact:!0,path:"/t/:name/:questionId/answer/:answerId/edit",render:this.editAnswer})))}}class it extends n.Component{constructor(e){super(e),this.showLoginForm=()=>n.createElement(D,{user:this.state.user}),this.showContent=()=>this.props.settings.test.test?this.showTestContent():this.showMainContent(),this.showMainContent=()=>n.createElement(ut,{user:this.state.user}),this.showTestContent=()=>null==this.props.settings.test.testContent?n.createElement(n.Fragment,null):n.createElement(o.a,null,n.createElement(c.d,null,this.props.settings.test.testContent(this.state.user))),this.state={user:new m}}componentDidMount(){var e;e=this.props.settings,k.configure(new b(e.backendUrl)),w.configure(()=>new g),j.configure(e)}render(){return n.createElement(f,null,n.createElement(P,{user:this.state.user,renderLoggedIn:this.showContent,renderLoggedOut:this.showLoginForm}))}}const pt=e=>n.createElement(n.Fragment,null,n.createElement(ct,{user:e})),lt=e=>{const t=Object(s.a)({},e.settings,{testContent:pt});return n.createElement(it,{settings:t})},ht=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function dt(){if("serviceWorker"in navigator){if(new URL("",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="".concat("","/service-worker.js");ht?(!function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):mt(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):mt(e)})}}function mt(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const t=e.installing;t&&(t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}new b("/").get("config.json").then(e=>{a.render(n.createElement(lt,{settings:e}),document.getElementById("root")),dt()})}]),[[32,1,2]]]);
//# sourceMappingURL=main.703c3819.chunk.js.map